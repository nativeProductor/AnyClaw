本文档是记忆系统与技能系统的跨领域引领文档。岗位对齐度不属于任何单一子系统——它是一个持续运行的治理信号，同时调控着记忆的写入、老化与清理，以及技能的生成、晋升与废弃。
一、为什么需要岗位对齐度
AnyClaw的行为由记忆和技能共同驱动。两者都在持续变化——记忆随用户交互积累，技能随自省迭代。这个变化过程中，存在三条让 Agent 悄然偏离原始岗位定义的漂移路径：
路径 A：知识扩散Layer 2（工作经验）被培训了超出岗位范围的知识，Agent 开始回答本不属于它职责的问题。例：报销专员被意外培训了 IT 报修流程，开始处理 IT 工单。
路径 B：模式蔓延Layer 5（程序性记忆）归纳了超出岗位工具白名单的操作步骤，Heartbeat 将其提案为新 Skill。例：Agent 频繁被要求查组织架构，归纳出调用 HR 接口的步骤。
路径 C：职责遗忘高频任务挤占 Agent 注意力，低频但重要的核心职责长期未被触发，事实上被"遗忘"。例：异常上报职责 30 天内从未触发，Agent 实际已丧失该能力。
路径 A、B 是行为外扩——Agent 做了不该做的事；路径 C 是行为内收——Agent 没做该做的事。岗位对齐度同时度量这两个方向。

---
二、定义
岗位对齐分（Job Alignment Score，JAS） 是衡量AnyClaw近期行为与其岗位定义匹配程度的量化指标，取值范围 [0, 1]，越高越好。
- 1.0：Agent 只做岗位定义内的事，且所有核心职责都有覆盖
- 0.8+：健康状态，少量偏差在容忍范围内
- 0.6~0.8：轻度漂移，进入观察期，发送告警
- 0.4~0.6：中度漂移，自动触发记忆审查和技能门控
- < 0.4：严重漂移，暂停自省生成，需要人工介入

---
三、计算方法
3.1 完整公式
JAS = Jaccard(A_actual, A_role) × Recall(D_role, D_actual)

其中：
  A_actual = 近 N 次工具调用所涉及的能力标签集合
  A_role   = 岗位定义的能力边界词集合（来自 Layer 1）
  D_role   = 岗位定义的核心职责集合（来自 Layer 1）
  D_actual = 近 N 次行为中实际覆盖的职责集合
两个子指标的语义：
子指标
公式
衡量什么
对应漂移路径
Jaccard
|A_actual ∩ A_role| / |A_actual ∪ A_role|
Agent 调用的能力有多少在岗位范围内（范围精度）
路径 A、B（外扩）
Recall
|D_actual ∩ D_role| / |D_role|
岗位核心职责有多少被实际覆盖（职责覆盖率）
路径 C（内收）
两个维度相乘：只有"不越界"且"不遗漏"才能得到高分。
3.2 输入数据来源
- 岗位基准（Layer 1）：岗位人设在发布时，系统自动提取「能力边界词集」和「核心职责列表」，存入岗位元数据。SHA-256 保护确保基准不可被 Agent 篡改。
- 行为观测窗口：默认近 50 次工具调用，可配置（见第七章）。
- 行为标签：每次任务完成，task_complete 钩子自动为本次行为打职责标签（如 [报销查询, 政策解答]），零 LLM 成本。
3.3 计算时机
时机
触发方
用途
Heartbeat soul_reflection（默认每天 1 次）
定时调度
写入自省报告，触发门控判断
开发者手动触发
管理界面
排查问题时即时计算
重大变更后自动触发
系统钩子
Layer 1 更新、大批 Skill 上线/下线后

---
四、影响因素：什么在驱动分数变化
4.1 记忆系统各层的影响
层
影响方向
典型场景
风险路径
Layer 1 岗位人设
定义基准（不会漂移）
开发者修改岗位定义 → 基准更新 → 分数重新计算
—
Layer 2 工作经验
影响 A_actual（新知识扩大行为范围）
超范围知识被写入 → Agent 开始回答岗位外问题
路径 A
Layer 3 用户记忆
影响 A_actual（用户偏好引导行为）
用户反复要求 Agent 做 X → L3 记为习惯 → Agent 倾向做 X
路径 A
Layer 4 会话上下文
单会话内短暂影响，会话结束自动归零
长对话末尾被引导出边界，不影响跨会话分数
低风险
Layer 5 程序性记忆
影响 A_actual（步骤包含越界工具调用）
归纳的步骤包含 HR 接口 → 提案 Skill → 越界能力被固化
路径 B
4.2 技能系统的影响
技能系统事件
对 JAS 的影响
新 Skill 上线（开发者安装）
扩大 A_role 白名单 → Jaccard 可能提升
Skill 废弃
对应职责可能进入未覆盖 → Recall 下降
Agent 自省生成新 Skill（source: reflection）
如果基于越界行为 → A_actual 扩大 → Jaccard 下降
Skill 使用率骤降
关联职责 D_actual 覆盖减少 → Recall 下降
4.3 用户行为的影响
用户是间接影响源。用户持续发出岗位外请求 → Agent 响应（L3 记住习惯，L5 归纳步骤）→ 行为标签扩散 → JAS 下降。这条路径完全不需要开发者操作，是最隐蔽的漂移机制。
五、对记忆系统的反向调控
JAS 下降时，系统自动向记忆系统发出调控指令，形成闭环：
5.1 分级响应
5.2 记忆层归因分析
告警触发时，系统自动生成归因报告，定位最可疑的记忆层：
归因报告（JAS 下降至 0.58，告警）
───────────────────────────────────────
Jaccard 下降分析：
  当前越界能力标签：[组织架构查询, HR 接口调用]
  来源追踪：
    - L5 程序性记忆：pattern "查询员工信息" → steps 包含 hr_api.get_employee
    - L3 用户记忆：用户李四 × 12 次请求含 "查人" 关键词
  最可疑层：Layer 5（贡献越界行为 67%）

Recall 下降分析：
  未覆盖职责：[异常上报]
  最近触发时间：18 天前
  可能原因：无用户触发 + 对应 Skill 调用量为 0

建议操作：
  1. 检查并清理 L5 中 task_pattern LIKE '查询员工%' 的记录
  2. 检查 L3 李四的记忆中是否存储了越界习惯
  3. 检查"异常上报"Skill 是否仍处于 live 状态
5.3 记忆写入时的前向边界校验
除了事后归因（后向防御），记忆写入时也应进行边界校验（前向防御）：
记忆层
写入时校验项
超界时处理
Layer 2 知识卡片
实体标签是否在岗位关键词集内（覆盖率 < 60% 视为超界）
标记 pending_review，不自动生效
Layer 3 用户习惯
被记录的习惯行为是否在岗位工具白名单内
不写入，仅记录为日志
Layer 5 程序步骤
步骤涉及的工具是否全在岗位工具白名单内
写入但标记 boundary_warning，不注入提示

---
六、对技能系统的反向调控
6.1 Skill 自生成门控
JAS 是 Skill 自生成流水线的核心门控信号：
Layer 5 pattern 达到 success_count ≥ 10 且 success_rate ≥ 80%
                            ↓
              【门控检查 1】JAS ≥ 0.6？
                  ↓ 否              ↓ 是
         拒绝提案             【门控检查 2】本提案涉及工具全在 A_role 内？
         记录原因                   ↓ 否              ↓ 是
                          拒绝提案 + 告警        生成 Skill 草稿 → 进入审核流程

核心原则：即使 Agent 反复成功做了某件事，只要该行为不在岗位定义内，就不应将其固化为 Skill。Skill 一旦上线会进一步强化该行为，形成正反馈漂移。
6.2 对 Skill 生命周期的干预
JAS 触发场景
对 Skill 系统的干预
JAS < 0.6（告警）
Skill 提案全部暂停；已有提案标记 alignment_hold
JAS < 0.4（严重）
除暂停提案外，对 source: reflection 的在线 Skill 全面复核
Recall 持续低（某职责 30 天未覆盖）
告警对应 Skill 是否仍然 live，建议开发者检查
JAS 恢复至 ≥ 0.8
自动解除 alignment_hold，恢复提案流程
6.3 自省报告中的完整呈现
每次 soul_reflection 产出的报告必须包含岗位对齐评估节，结构见技能系统设计 §5.3。报告是开发者理解 Agent 行为状态的主要窗口。
七、监控与人工介入
7.1 分级告警规则
级别
触发条件
通知方式
自动操作
观察
0.6 ≤ JAS < 0.8
应用内通知（低优先级）
无，仅记录
告警
0.4 ≤ JAS < 0.6
即时推送 + 邮件
暂停 L5/L2 自动写入；暂停 Skill 提案
紧急
JAS < 0.4
即时推送 + 电话/IM
暂停所有自省；冻结记忆写入；通知 On-call
7.2 开发者介入界面（管理后台）
对齐度看板
- JAS 趋势折线图（30 天）
- 当前 Jaccard / Recall 分项值
- 越界能力标签列表（点击溯源到具体 L5/L3 记录）
- 未覆盖职责列表（点击查看对应 Skill 状态）归因明细
- 按层展示贡献度
- 最近变更时间线（L2 新增知识、L5 新增模式）
- 关联用户行为统计
一键干预操作
- 清除指定 L5 pattern（批量 / 单条）
- 清除指定 L3 用户越界习惯记忆
- 撤回指定 L2 知识卡片
- 手动触发重新计算 JAS
- 解除 alignment_hold（恢复提案流程）岗位基准管理
- 编辑能力边界词集（更新后自动触发重计算）
- 编辑核心职责列表
- 查看 SHA-256 校验状态
7.3 自动恢复机制
人工修正（清除越界记忆、下线越界 Skill）完成后，无需手动解锁：
开发者完成修正操作
        ↓
下一个 Heartbeat soul_reflection 运行
        ↓
重新计算 JAS
        ↓
JAS ≥ 0.8？ → 自动解除所有 alignment_hold → 恢复正常运营
JAS ∈ [0.6, 0.8)？ → 解除暂停，保持告警状态
JAS < 0.6？ → 继续暂停，发送"修正不足"通知




---
7.4 JAS × 成本：双维度健康矩阵
岗位对齐度与运营成本是评估AnyClaw健康状态的两个正交维度，组合形成 2×2 健康矩阵：

成本正常
成本偏高
对齐良好（JAS ≥ 0.8）
✅ 健康运行
💡 效率待优化
存在漂移（JAS < 0.8）
⚠️ 行为风险
🚨 紧急干预
四个象限解读：
- ✅ 健康运行：AnyClaw行为合规、成本正常，无需干预
- 💡 效率待优化：行为合规但成本偏高。排查 Layer 2 检索效率——是否存在僵尸卡片？Top-K 值是否过大？
- ⚠️ 行为风险：存在漂移但成本未见异常。可能是越界行为频率尚低，需尽早处理防止漂移固化
- 🚨 紧急干预（最危险象限）：越界行为推动 Layer 2/5 膨胀，同时拉高成本，两者相互强化——越界知识越多，检索注入越多，成本越高。需立即人工介入
右下象限（漂移 + 高成本）是最危险状态。成本的异常上升本身可以作为行为漂移的早期预警信号——当成本上涨但用户请求量未变时，应优先检查 JAS 变化趋势。
完整成本观测框架见 → AnyClaw — 成本观测与优化体系

---
八、与各子系统设计文档的关系
子系统文档
本文档对应章节
子系统文档补充的内容
记忆系统设计 §十二
第四章、第五章
各层具体的写入校验实现细节；归因算法实现
技能系统设计 §五
第六章
完整自省报告结构；Skill 提案门控代码逻辑
成本观测与优化体系
第七章 7.4 节
Token per-layer 归因实现；Layer 2 检索效率与僵尸卡片检测；JAS × 成本双维度矩阵

---
附录：相关文档
- AnyClaw — 记忆系统设计
- AnyClaw — 技能系统设计
- Conway Research/automaton（Genesis Alignment Score 原始参考）
- AnyClaw — 成本观测与优化体系（JAS × 成本双维度健康矩阵参考）
